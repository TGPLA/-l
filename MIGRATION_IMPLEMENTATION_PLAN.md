# é˜…è¯»å›å“é¡¹ç›® - å›½äº§å¹³å°è¿ç§»å®æ–½è®¡åˆ’

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [å½“å‰æ¶æ„åˆ†æ](#å½“å‰æ¶æ„åˆ†æ)
3. [ç›®æ ‡æ¶æ„è®¾è®¡](#ç›®æ ‡æ¶æ„è®¾è®¡)
4. [è¿ç§»æ–¹æ¡ˆé€‰æ‹©](#è¿ç§»æ–¹æ¡ˆé€‰æ‹©)
5. [è¯¦ç»†å®æ–½æ­¥éª¤](#è¯¦ç»†å®æ–½æ­¥éª¤)
6. [æ—¶é—´è§„åˆ’](#æ—¶é—´è§„åˆ’)
7. [é£é™©è¯„ä¼°](#é£é™©è¯„ä¼°)
8. [å›æ»šæ–¹æ¡ˆ](#å›æ»šæ–¹æ¡ˆ)
9. [éªŒè¯æµ‹è¯•](#éªŒè¯æµ‹è¯•)
10. [ä¸Šçº¿åˆ‡æ¢](#ä¸Šçº¿åˆ‡æ¢)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
**é˜…è¯»å›å“ (ReadRecall)** - é€šè¿‡ä¸»åŠ¨å›å¿†æœºåˆ¶åŠ æ·±ä¹¦ç±ç†è§£çš„ä¸ªäººåˆ·é¢˜å·¥å…·

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ“š ä¹¦ç±ç®¡ç†ï¼ˆæ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤ï¼‰
- ğŸ“ é—®é¢˜ç®¡ç†ï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€æ‰¹é‡ç®¡ç†ï¼‰
- ğŸ¯ ç»ƒä¹ æ¨¡å¼ï¼ˆæ ‡å‡†ç»ƒä¹ ã€æ¦‚å¿µç»ƒä¹ ã€é”™é¢˜ç»ƒä¹ ï¼‰
- ğŸ¤– AI è¾…åŠ©ï¼ˆæ™ºè°±AIç”Ÿæˆé—®é¢˜å’Œæ‰¹æ”¹ï¼‰
- âš™ï¸ è®¾ç½®ç®¡ç†ï¼ˆæ·±è‰²æ¨¡å¼ã€APIé…ç½®ï¼‰
- ğŸ‘¤ ç”¨æˆ·è®¤è¯ï¼ˆæ³¨å†Œã€ç™»å½•ã€ç™»å‡ºï¼‰
- ğŸ”„ æ•°æ®åŒæ­¥ï¼ˆå¤šè®¾å¤‡æ•°æ®åŒæ­¥ï¼‰

### æŠ€æœ¯æ ˆ
| å±‚çº§ | å½“å‰æŠ€æœ¯ | å›½äº§æ›¿ä»£ |
|------|---------|---------|
| å‰ç«¯æ¡†æ¶ | React 19 | React 19 |
| æ„å»ºå·¥å…· | Vite 6 | Vite 6 |
| è®¤è¯æœåŠ¡ | Supabase Auth | é˜¿é‡Œäº‘è®¤è¯æœåŠ¡ |
| æ•°æ®åº“ | Supabase PostgreSQL | é˜¿é‡Œäº‘ RDS PostgreSQL |
| å­˜å‚¨æœåŠ¡ | Supabase Storage | é˜¿é‡Œäº‘ OSS |
| AI æœåŠ¡ | æ™ºè°±AI | æ™ºè°±AIï¼ˆå·²å›½äº§ï¼‰ |
| éƒ¨ç½²å¹³å° | Vercel â†’ è…¾è®¯äº‘ EdgeOne Pages | è…¾è®¯äº‘ EdgeOne Pages |

---

## å½“å‰æ¶æ„åˆ†æ

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æµè§ˆå™¨                             â”‚
â”‚                   (React + Vite)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTPS
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è…¾è®¯äº‘ EdgeOne Pages                          â”‚
â”‚              (é™æ€ç½‘ç«™æ‰˜ç®¡ + CDN)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ API è°ƒç”¨
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Supabase æœåŠ¡                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Auth       â”‚  â”‚  PostgreSQL  â”‚  â”‚   Storage    â”‚   â”‚
â”‚  â”‚  (è®¤è¯æœåŠ¡)   â”‚  â”‚   (æ•°æ®åº“)    â”‚  â”‚  (æ–‡ä»¶å­˜å‚¨)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ API è°ƒç”¨
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ™ºè°± AI                                 â”‚
â”‚              (AI é—®é¢˜ç”Ÿæˆ + æ‰¹æ”¹)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å½“å‰æœåŠ¡ä¾èµ–
```typescript
// è®¤è¯æœåŠ¡
src/services/supabaseAuth.ts
  â”œâ”€â”€ supabase.auth.signUp()
  â”œâ”€â”€ supabase.auth.signInWithPassword()
  â”œâ”€â”€ supabase.auth.signOut()
  â”œâ”€â”€ supabase.auth.resetPassword()
  â””â”€â”€ supabase.auth.updatePassword()

// æ•°æ®åº“æœåŠ¡
src/services/database.ts
  â”œâ”€â”€ supabase.from('books').select()
  â”œâ”€â”€ supabase.from('questions').select()
  â”œâ”€â”€ supabase.from('user_settings').select()
  â””â”€â”€ supabase.from('books').insert()

// AI æœåŠ¡
src/api/zhipu.ts
  â””â”€â”€ fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions')

src/api/dify.ts
  â””â”€â”€ fetch('https://api.dify.ai/v1/chat-messages')
```

### æ•°æ®åº“ç»“æ„
```sql
-- ä¹¦ç±è¡¨
CREATE TABLE books (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  title TEXT NOT NULL,
  author TEXT,
  cover_url TEXT,
  description TEXT,
  question_count INTEGER DEFAULT 0,
  mastered_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- é—®é¢˜è¡¨
CREATE TABLE questions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  book_id UUID NOT NULL REFERENCES books(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES auth.users(id),
  question TEXT NOT NULL,
  answer TEXT,
  type TEXT DEFAULT 'standard',
  difficulty INTEGER DEFAULT 1,
  mastered BOOLEAN DEFAULT FALSE,
  last_reviewed_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ç”¨æˆ·è®¾ç½®è¡¨
CREATE TABLE user_settings (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  dark_mode BOOLEAN DEFAULT FALSE,
  zhipu_api_key TEXT,
  zhipu_model TEXT DEFAULT 'glm-4',
  dify_api_key TEXT,
  question_workflow_url TEXT,
  correction_workflow_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

---

## ç›®æ ‡æ¶æ„è®¾è®¡

### æ¨èæ–¹æ¡ˆï¼šé˜¿é‡Œäº‘å…¨å®¶æ¡¶ + è…¾è®¯äº‘ EdgeOne Pages

### ç³»ç»Ÿæ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·æµè§ˆå™¨                             â”‚
â”‚                   (React + Vite)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTPS
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è…¾è®¯äº‘ EdgeOne Pages                          â”‚
â”‚              (é™æ€ç½‘ç«™æ‰˜ç®¡ + CDN)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ API è°ƒç”¨
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   é˜¿é‡Œäº‘æœåŠ¡                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  è®¤è¯æœåŠ¡    â”‚  â”‚  RDS PostgreSQLâ”‚  â”‚     OSS      â”‚   â”‚
â”‚  â”‚ (é˜¿é‡Œäº‘è®¤è¯)  â”‚  â”‚   (æ•°æ®åº“)    â”‚  â”‚  (æ–‡ä»¶å­˜å‚¨)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ API è°ƒç”¨
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ™ºè°± AI                                 â”‚
â”‚              (AI é—®é¢˜ç”Ÿæˆ + æ‰¹æ”¹)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æœåŠ¡æ˜ å°„è¡¨
| å½“å‰æœåŠ¡ | è¿ç§»ç›®æ ‡ | äº§å“åç§° | åŠŸèƒ½ |
|---------|---------|---------|------|
| Supabase Auth | é˜¿é‡Œäº‘è®¤è¯æœåŠ¡ | é˜¿é‡Œäº‘ IDaaS | ç”¨æˆ·è®¤è¯ã€ä¼šè¯ç®¡ç† |
| Supabase PostgreSQL | é˜¿é‡Œäº‘ RDS | é˜¿é‡Œäº‘ RDS PostgreSQL | å…³ç³»å‹æ•°æ®åº“ |
| Supabase Storage | é˜¿é‡Œäº‘ OSS | é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ OSS | æ–‡ä»¶å­˜å‚¨ |
| Supabase Edge Functions | é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— | é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— FC | æœåŠ¡ç«¯é€»è¾‘ |
| Vercel | è…¾è®¯äº‘ EdgeOne Pages | è…¾è®¯äº‘ EdgeOne Pages | é™æ€ç½‘ç«™æ‰˜ç®¡ |
| æ™ºè°± AI | æ™ºè°± AI | æ™ºè°± AI | AI æœåŠ¡ï¼ˆä¿æŒä¸å˜ï¼‰ |

---

## è¿ç§»æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆå¯¹æ¯”

#### æ–¹æ¡ˆ 1ï¼šé˜¿é‡Œäº‘å…¨å®¶æ¡¶ï¼ˆæ¨è â­â­â­â­â­ï¼‰
**ä¼˜åŠ¿ï¼š**
- âœ… ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œé›†æˆåº¦é«˜
- âœ… å›½å†…è®¿é—®é€Ÿåº¦å¿«
- âœ… æ–‡æ¡£ä¸°å¯Œï¼Œç¤¾åŒºæ´»è·ƒ
- âœ… ä»·æ ¼åˆç†ï¼Œæˆæœ¬å¯æ§
- âœ… æŠ€æœ¯æ”¯æŒå¼ºï¼Œå“åº”åŠæ—¶

**åŠ£åŠ¿ï¼š**
- âš ï¸ éœ€è¦å­¦ä¹ é˜¿é‡Œäº‘æœåŠ¡
- âš ï¸ åˆæœŸé…ç½®è¾ƒå¤æ‚

**é€‚ç”¨åœºæ™¯ï¼š** è¿½æ±‚ç¨³å®šæ€§å’Œé›†æˆåº¦çš„é¡¹ç›®

#### æ–¹æ¡ˆ 2ï¼šè…¾è®¯äº‘å…¨å®¶æ¡¶ï¼ˆæ¨è â­â­â­â­ï¼‰
**ä¼˜åŠ¿ï¼š**
- âœ… ä¸ EdgeOne Pages é›†æˆåº¦é«˜
- âœ… å›½å†…è®¿é—®é€Ÿåº¦å¿«
- âœ… ä»·æ ¼ä¼˜æƒ ï¼Œæ€§ä»·æ¯”é«˜
- âœ… æŠ€æœ¯æ”¯æŒåŠæ—¶

**åŠ£åŠ¿ï¼š**
- âš ï¸ éƒ¨åˆ†æœåŠ¡åŠŸèƒ½ä¸å¦‚é˜¿é‡Œäº‘å®Œå–„
- âš ï¸ æ–‡æ¡£ç›¸å¯¹è¾ƒå°‘

**é€‚ç”¨åœºæ™¯ï¼š** å·²ä½¿ç”¨ EdgeOne Pagesï¼Œè¿½æ±‚æ€§ä»·æ¯”çš„é¡¹ç›®

#### æ–¹æ¡ˆ 3ï¼šæ··åˆæ–¹æ¡ˆï¼ˆæ¨è â­â­â­ï¼‰
**ä¼˜åŠ¿ï¼š**
- âœ… çµæ´»æ€§é«˜ï¼Œé€‰æ‹©æœ€ä½³æœåŠ¡
- âœ… é¿å…å‚å•†é”å®š
- âœ… æˆæœ¬ä¼˜åŒ–ç©ºé—´å¤§

**åŠ£åŠ¿ï¼š**
- âš ï¸ ç®¡ç†å¤æ‚åº¦å¢åŠ 
- âš ï¸ éœ€è¦é…ç½®è·¨å¹³å°è®¿é—®
- âš ï¸ æ•…éšœæ’æŸ¥å›°éš¾

**é€‚ç”¨åœºæ™¯ï¼š** æœ‰å¤šä¸ªäº‘å¹³å°ä½¿ç”¨ç»éªŒçš„å›¢é˜Ÿ

### æœ€ç»ˆæ¨èï¼š**æ–¹æ¡ˆ 1 - é˜¿é‡Œäº‘å…¨å®¶æ¡¶**

**ç†ç”±ï¼š**
1. é˜¿é‡Œäº‘è®¤è¯æœåŠ¡åŠŸèƒ½å®Œå–„ï¼Œæ›¿ä»£ Supabase Auth
2. RDS PostgreSQL æ€§èƒ½ç¨³å®šï¼ŒåŠŸèƒ½ä¸°å¯Œ
3. OSS æˆæœ¬ä½ï¼ŒåŠŸèƒ½å¼ºå¤§
4. å‡½æ•°è®¡ç®— FC æ”¯æŒå¤šç§è¿è¡Œæ—¶
5. ä¸ EdgeOne Pages é…åˆï¼Œå®ç°å‰åç«¯åˆ†ç¦»

---

## è¯¦ç»†å®æ–½æ­¥éª¤

### é˜¶æ®µ 1ï¼šå‡†å¤‡é˜¶æ®µï¼ˆç¬¬ 1 å‘¨ï¼‰

#### 1.1 è´¦æˆ·å’Œæƒé™å‡†å¤‡
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ³¨å†Œé˜¿é‡Œäº‘è´¦æˆ·
- [ ] å®Œæˆå®åè®¤è¯
- [ ] å¼€é€šå¿…è¦æœåŠ¡ï¼š
  - [ ] é˜¿é‡Œäº‘ IDaaSï¼ˆè®¤è¯æœåŠ¡ï¼‰
  - [ ] é˜¿é‡Œäº‘ RDS PostgreSQL
  - [ ] é˜¿é‡Œäº‘ OSS
  - [ ] é˜¿é‡Œäº‘å‡½æ•°è®¡ç®— FC
  - [ ] é˜¿é‡Œäº‘ ARMSï¼ˆç›‘æ§æœåŠ¡ï¼‰
- [ ] åˆ›å»º AccessKeyï¼ˆAPI è®¿é—®å¯†é’¥ï¼‰
- [ ] é…ç½® RAM æƒé™ï¼ˆè®¿é—®æ§åˆ¶ï¼‰

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **æ³¨å†Œé˜¿é‡Œäº‘è´¦æˆ·**
   - è®¿é—®ï¼šhttps://www.aliyun.com
   - ç‚¹å‡»"å…è´¹æ³¨å†Œ"
   - å¡«å†™æ³¨å†Œä¿¡æ¯
   - å®Œæˆæ‰‹æœºéªŒè¯å’Œé‚®ç®±éªŒè¯

2. **å®åè®¤è¯**
   - ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
   - è¿›å…¥"è´¦å·ä¸­å¿ƒ" â†’ "å®åè®¤è¯"
   - é€‰æ‹©"ä¸ªäººè®¤è¯"æˆ–"ä¼ä¸šè®¤è¯"
   - ä¸Šä¼ èº«ä»½è¯ä»¶æˆ–ä¼ä¸šè¯ä»¶
   - ç­‰å¾…å®¡æ ¸ï¼ˆé€šå¸¸ 1-2 ä¸ªå·¥ä½œæ—¥ï¼‰

3. **å¼€é€šæœåŠ¡**
   - è®¿é—®ï¼šhttps://console.aliyun.com
   - æœç´¢å¹¶å¼€é€šä»¥ä¸‹æœåŠ¡ï¼š
     - "IDaaS"ï¼ˆèº«ä»½è®¤è¯æœåŠ¡ï¼‰
     - "RDS"ï¼ˆäº‘æ•°æ®åº“ï¼‰
     - "OSS"ï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰
     - "å‡½æ•°è®¡ç®—"ï¼ˆServerless è®¡ç®—ï¼‰
     - "ARMS"ï¼ˆåº”ç”¨å®æ—¶ç›‘æ§ï¼‰

4. **åˆ›å»º AccessKey**
   - è®¿é—®ï¼šhttps://ram.console.aliyun.com/manage/ak
   - ç‚¹å‡»"åˆ›å»º AccessKey"
   - é€‰æ‹©"ç»§ç»­ä½¿ç”¨ AccessKey"
   - ä¿å­˜ AccessKey ID å’Œ AccessKey Secretï¼ˆåªæ˜¾ç¤ºä¸€æ¬¡ï¼‰

5. **é…ç½® RAM æƒé™**
   - è®¿é—®ï¼šhttps://ram.console.aliyun.com/users
   - åˆ›å»ºå­ç”¨æˆ·
   - æˆäºˆå¿…è¦çš„æƒé™ï¼š
     - AliyunRDSFullAccessï¼ˆRDS å®Œå…¨è®¿é—®ï¼‰
     - AliyunOSSFullAccessï¼ˆOSS å®Œå…¨è®¿é—®ï¼‰
     - AliyunFCFullAccessï¼ˆå‡½æ•°è®¡ç®—å®Œå…¨è®¿é—®ï¼‰
     - AliyunIDaaSFullAccessï¼ˆIDaaS å®Œå…¨è®¿é—®ï¼‰

#### 1.2 æ•°æ®å¤‡ä»½
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¯¼å‡º Supabase æ•°æ®åº“ç»“æ„å’Œæ•°æ®
- [ ] å¤‡ä»½ç”¨æˆ·æ•°æ®å’Œè®¾ç½®
- [ ] å¤‡ä»½ AI é…ç½®ä¿¡æ¯
- [ ] å¤‡ä»½ç¯å¢ƒå˜é‡é…ç½®

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **å¯¼å‡º Supabase æ•°æ®åº“**
   ```sql
   -- ä½¿ç”¨ pg_dump å¯¼å‡ºæ•°æ®åº“
   pg_dump -h db.ohqkqnhmgzqeqdsueiih.supabase.co \
           -U postgres \
           -d postgres \
           -F c \
           -f supabase_backup.dump
   ```

2. **å¤‡ä»½ç”¨æˆ·æ•°æ®**
   - åœ¨ Supabase Dashboard ä¸­ï¼š
     - è¿›å…¥ "Authentication" â†’ "Users"
     - å¯¼å‡ºç”¨æˆ·åˆ—è¡¨ï¼ˆCSV æ ¼å¼ï¼‰

3. **å¤‡ä»½ç¯å¢ƒå˜é‡**
   ```bash
   # å¤‡ä»½ Vercel ç¯å¢ƒå˜é‡
   vercel env pull .env.local
   ```

4. **ä¿å­˜é…ç½®ä¿¡æ¯**
   - åˆ›å»ºé…ç½®æ–‡æ¡£ `migration-config.md`ï¼š
     ```markdown
     # è¿ç§»é…ç½®ä¿¡æ¯

     ## Supabase é…ç½®
     - Project URL: https://ohqkqnhmgzqeqdsueiih.supabase.co
     - Anon Key: sb_publishable_AG0a_37OtsrePOc4aEp9Rw_z2Q_ZkWD

     ## æ™ºè°± AI é…ç½®
     - API Key: [ä½ çš„æ™ºè°± API Key]
     - Model: glm-4

     ## Dify é…ç½®
     - API Key: [ä½ çš„ Dify API Key]
     - Question Workflow URL: [é—®é¢˜ç”Ÿæˆå·¥ä½œæµ URL]
     - Correction Workflow URL: [æ‰¹æ”¹å·¥ä½œæµ URL]
     ```

#### 1.3 ç¯å¢ƒæ­å»º
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] åˆ›å»ºé˜¿é‡Œäº‘ RDS PostgreSQL å®ä¾‹
- [ ] åˆ›å»ºé˜¿é‡Œäº‘ OSS å­˜å‚¨æ¡¶
- [ ] é…ç½®é˜¿é‡Œäº‘ IDaaS åº”ç”¨
- [ ] åˆ›å»ºé˜¿é‡Œäº‘å‡½æ•°è®¡ç®—æœåŠ¡
- [ ] é…ç½®ç½‘ç»œå’Œå®‰å…¨ç»„

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **åˆ›å»º RDS PostgreSQL å®ä¾‹**
   - è®¿é—®ï¼šhttps://rds.console.aliyun.com
   - ç‚¹å‡»"åˆ›å»ºå®ä¾‹"
   - é…ç½®å‚æ•°ï¼š
     - æ•°æ®åº“å¼•æ“ï¼šPostgreSQL
     - ç‰ˆæœ¬ï¼š14 æˆ– 15
     - å®ä¾‹è§„æ ¼ï¼šæŒ‰éœ€é€‰æ‹©ï¼ˆå»ºè®® 2æ ¸4GB èµ·æ­¥ï¼‰
     - å­˜å‚¨ç©ºé—´ï¼š20GB èµ·æ­¥
     - VPC ç½‘ç»œï¼šé»˜è®¤ VPC
     - ç™½åå•è®¾ç½®ï¼šæ·»åŠ å¼€å‘æœåŠ¡å™¨ IP
   - ç­‰å¾…å®ä¾‹åˆ›å»ºï¼ˆçº¦ 5-10 åˆ†é’Ÿï¼‰

2. **åˆ›å»º OSS å­˜å‚¨æ¡¶**
   - è®¿é—®ï¼šhttps://oss.console.aliyun.com
   - ç‚¹å‡»"åˆ›å»º Bucket"
   - é…ç½®å‚æ•°ï¼š
     - Bucket åç§°ï¼šreadrecall-filesï¼ˆå…¨å±€å”¯ä¸€ï¼‰
     - åŒºåŸŸï¼šåä¸œ1ï¼ˆæ­å·ï¼‰
     - å­˜å‚¨ç±»å‹ï¼šæ ‡å‡†å­˜å‚¨
     - è¯»å†™æƒé™ï¼šç§æœ‰
   - ç‚¹å‡»"ç¡®å®š"

3. **é…ç½® IDaaS åº”ç”¨**
   - è®¿é—®ï¼šhttps://idaas.console.aliyun.com
   - ç‚¹å‡»"åˆ›å»ºåº”ç”¨"
   - åº”ç”¨ç±»å‹ï¼šWeb åº”ç”¨
   - åº”ç”¨åç§°ï¼šé˜…è¯»å›å“
   - å›è°ƒåœ°å€ï¼šhttps://linyubo.top/auth/callback
   - ä¿å­˜åº”ç”¨ ID å’Œå¯†é’¥

4. **åˆ›å»ºå‡½æ•°è®¡ç®—æœåŠ¡**
   - è®¿é—®ï¼šhttps://fc.console.aliyun.com
   - ç‚¹å‡»"åˆ›å»ºæœåŠ¡"
   - æœåŠ¡åç§°ï¼šreadrecall-api
   - è¿è¡Œæ—¶ï¼šNode.js 20
   - VPC ç½‘ç»œï¼šé€‰æ‹©ä¸ RDS ç›¸åŒçš„ VPC

#### 1.4 ä»£ç å‡†å¤‡
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] åˆ›å»ºæ–°çš„ Git åˆ†æ”¯ç”¨äºè¿ç§»
- [ ] åˆ›å»ºè¿ç§»é…ç½®æ–‡ä»¶
- [ ] å‡†å¤‡æ•°æ®åº“è¿ç§»è„šæœ¬
- [ ] å‡†å¤‡ API é€‚é…ä»£ç 

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **åˆ›å»ºè¿ç§»åˆ†æ”¯**
   ```bash
   git checkout -b feature/migrate-to-aliyun
   ```

2. **åˆ›å»ºè¿ç§»é…ç½®æ–‡ä»¶**
   ```typescript
   // src/config/aliyun.ts
   export const aliyunConfig = {
     rds: {
       host: process.env.VITE_ALIYUN_RDS_HOST,
       port: 5432,
       user: process.env.VITE_ALIYUN_RDS_USER,
       password: process.env.VITE_ALIYUN_RDS_PASSWORD,
       database: process.env.VITE_ALIYUN_RDS_DATABASE,
     },
     oss: {
       region: process.env.VITE_ALIYUN_OSS_REGION,
       accessKeyId: process.env.VITE_ALIYUN_OSS_ACCESS_KEY_ID,
       accessKeySecret: process.env.VITE_ALIYUN_OSS_ACCESS_KEY_SECRET,
       bucket: process.env.VITE_ALIYUN_OSS_BUCKET,
     },
     idaas: {
       clientId: process.env.VITE_ALIYUN_IDAAS_CLIENT_ID,
       clientSecret: process.env.VITE_ALIYUN_IDAAS_CLIENT_SECRET,
       redirectUri: process.env.VITE_ALIYUN_IDAAS_REDIRECT_URI,
     },
   };
   ```

3. **å‡†å¤‡æ•°æ®åº“è¿ç§»è„šæœ¬**
   ```sql
   -- supabase/migrations/001_initial_schema_aliyun.sql
   -- ä¸ Supabase ç›¸åŒçš„æ•°æ®åº“ç»“æ„
   ```

---

### é˜¶æ®µ 2ï¼šæ ¸å¿ƒæœåŠ¡è¿ç§»ï¼ˆç¬¬ 2-3 å‘¨ï¼‰

#### 2.1 æ•°æ®åº“è¿ç§»
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
- [ ] å¯¼å…¥æ•°æ®
- [ ] é…ç½®æ•°æ®åº“è¿æ¥
- [ ] æµ‹è¯•æ•°æ®åº“æ“ä½œ

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„**
   ```sql
   -- åœ¨é˜¿é‡Œäº‘ RDS ä¸­æ‰§è¡Œä»¥ä¸‹ SQL

   -- åˆ›å»ºæ‰©å±•
   CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

   -- åˆ›å»ºç”¨æˆ·è¡¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
   CREATE TABLE IF NOT EXISTS users (
     id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
     email TEXT UNIQUE NOT NULL,
     password_hash TEXT NOT NULL,
     created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
     updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );

   -- åˆ›å»ºä¹¦ç±è¡¨
   CREATE TABLE IF NOT EXISTS books (
     id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
     user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
     title TEXT NOT NULL,
     author TEXT,
     cover_url TEXT,
     description TEXT,
     question_count INTEGER DEFAULT 0,
     mastered_count INTEGER DEFAULT 0,
     created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
     updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );

   -- åˆ›å»ºé—®é¢˜è¡¨
   CREATE TABLE IF NOT EXISTS questions (
     id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
     book_id UUID NOT NULL REFERENCES books(id) ON DELETE CASCADE,
     user_id UUID NOT NULL REFERENCES users(id),
     question TEXT NOT NULL,
     answer TEXT,
     type TEXT DEFAULT 'standard',
     difficulty INTEGER DEFAULT 1,
     mastered BOOLEAN DEFAULT FALSE,
     last_reviewed_at TIMESTAMP WITH TIME ZONE,
     created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
     updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );

   -- åˆ›å»ºç”¨æˆ·è®¾ç½®è¡¨
   CREATE TABLE IF NOT EXISTS user_settings (
     user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,
     dark_mode BOOLEAN DEFAULT FALSE,
     zhipu_api_key TEXT,
     zhipu_model TEXT DEFAULT 'glm-4',
     dify_api_key TEXT,
     question_workflow_url TEXT,
     correction_workflow_url TEXT,
     created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
     updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
   );

   -- åˆ›å»ºç´¢å¼•
   CREATE INDEX IF NOT EXISTS idx_books_user_id ON books(user_id);
   CREATE INDEX IF NOT EXISTS idx_questions_book_id ON questions(book_id);
   CREATE INDEX IF NOT EXISTS idx_questions_user_id ON questions(user_id);
   ```

2. **å¯¼å…¥æ•°æ®**
   ```bash
   # ä½¿ç”¨ pg_restore å¯¼å…¥æ•°æ®
   pg_restore -h <RDS_HOST> \
              -U <RDS_USER> \
              -d <RDS_DATABASE> \
              -f supabase_backup.dump
   ```

3. **é…ç½®æ•°æ®åº“è¿æ¥**
   ```typescript
   // src/lib/aliyun-db.ts
   import { Pool } from 'pg';

   const pool = new Pool({
     host: process.env.VITE_ALIYUN_RDS_HOST,
     port: 5432,
     user: process.env.VITE_ALIYUN_RDS_USER,
     password: process.env.VITE_ALIYUN_RDS_PASSWORD,
     database: process.env.VITE_ALIYUN_RDS_DATABASE,
   });

   export const query = async (text: string, params?: any[]) => {
     const start = Date.now();
     try {
       const res = await pool.query(text, params);
       const duration = Date.now() - start;
       console.log('Executed query', { text, duration, rows: res.rowCount });
       return res;
     } catch (error) {
       console.error('Database query error', error);
       throw error;
     }
   };

   export default pool;
   ```

4. **æµ‹è¯•æ•°æ®åº“æ“ä½œ**
   ```typescript
   // src/services/aliyunDatabase.ts
   import { query } from '../lib/aliyun-db';

   export class AliyunDatabaseService {
     async testConnection() {
       try {
         const result = await query('SELECT NOW()');
         console.log('Database connection successful:', result.rows[0]);
         return true;
       } catch (error) {
         console.error('Database connection failed:', error);
         return false;
       }
     }

     async getAllBooks(userId: string) {
       const result = await query(
         'SELECT * FROM books WHERE user_id = $1 ORDER BY created_at DESC',
         [userId]
       );
       return result.rows;
     }

     // ... å…¶ä»–æ•°æ®åº“æ“ä½œæ–¹æ³•
   }
   ```

#### 2.2 è®¤è¯æœåŠ¡è¿ç§»
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é…ç½®é˜¿é‡Œäº‘ IDaaS
- [ ] å®ç°è®¤è¯æœåŠ¡ç±»
- [ ] è¿ç§»ç”¨æˆ·æ•°æ®
- [ ] æµ‹è¯•è®¤è¯æµç¨‹

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **é…ç½®é˜¿é‡Œäº‘ IDaaS**
   - åœ¨ IDaaS æ§åˆ¶å°ï¼š
     - åˆ›å»ºåº”ç”¨ï¼šé˜…è¯»å›å“
     - é…ç½®å›è°ƒåœ°å€ï¼šhttps://linyubo.top/auth/callback
     - å¯ç”¨é‚®ç®±å¯†ç ç™»å½•
     - å¯ç”¨æ³¨å†ŒåŠŸèƒ½
     - é…ç½® JWT ç­¾åå¯†é’¥

2. **å®ç°è®¤è¯æœåŠ¡ç±»**
   ```typescript
   // src/services/aliyunAuth.ts
   export class AliyunAuthService {
     private currentUser: AuthUser | null = null;
     private listeners: ((user: AuthUser | null) => void)[] = [];

     constructor() {
       this.initializeAuth();
     }

     private async initializeAuth() {
       // ä» localStorage è·å– token
       const token = localStorage.getItem('aliyun_token');
       if (token) {
         try {
           const user = await this.verifyToken(token);
           this.currentUser = user;
           this.notifyListeners(user);
         } catch (error) {
           localStorage.removeItem('aliyun_token');
         }
       }
     }

     async signUp(email: string, password: string): Promise<{ user: AuthUser | null; error: AuthError | null }> {
       try {
         const response = await fetch('https://idaas.aliyuncs.com/api/v1/signup', {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify({ email, password }),
         });

         const data = await response.json();

         if (data.error) {
           return { user: null, error: { message: data.error.message } };
         }

         this.currentUser = data.user;
         localStorage.setItem('aliyun_token', data.token);
         this.notifyListeners(data.user);

         return { user: data.user, error: null };
       } catch (error) {
         return {
           user: null,
           error: { message: error instanceof Error ? error.message : 'æ³¨å†Œå¤±è´¥' },
         };
       }
     }

     async signIn(email: string, password: string): Promise<{ user: AuthUser | null; error: AuthError | null }> {
       try {
         const response = await fetch('https://idaas.aliyuncs.com/api/v1/signin', {
           method: 'POST',
           headers: { 'Content-Type': 'application/json' },
           body: JSON.stringify({ email, password }),
         });

         const data = await response.json();

         if (data.error) {
           return { user: null, error: { message: data.error.message } };
         }

         this.currentUser = data.user;
         localStorage.setItem('aliyun_token', data.token);
         this.notifyListeners(data.user);

         return { user: data.user, error: null };
       } catch (error) {
         return {
           user: null,
           error: { message: error instanceof Error ? error.message : 'ç™»å½•å¤±è´¥' },
         };
       }
     }

     async signOut(): Promise<{ error: AuthError | null }> {
       try {
         localStorage.removeItem('aliyun_token');
         this.currentUser = null;
         this.notifyListeners(null);
         return { error: null };
       } catch (error) {
         return {
           error: { message: error instanceof Error ? error.message : 'ç™»å‡ºå¤±è´¥' },
         };
       }
     }

     onAuthChange(callback: (user: AuthUser | null) => void) {
       this.listeners.push(callback);
       return () => {
         this.listeners = this.listeners.filter(l => l !== callback);
       };
     }

     private notifyListeners(user: AuthUser | null) {
       this.listeners.forEach(listener => listener(user));
     }

     private async verifyToken(token: string): Promise<AuthUser> {
       const response = await fetch('https://idaas.aliyuncs.com/api/v1/verify', {
         method: 'POST',
         headers: { 'Authorization': `Bearer ${token}` },
       });

       const data = await response.json();
       return data.user;
     }

     isAuthenticated(): boolean {
       return this.currentUser !== null;
     }

    getCurrentUser(): AuthUser | null {
      return this.currentUser;
    }
   }

   export const aliyunAuthService = new AliyunAuthService();
   ```

3. **è¿ç§»ç”¨æˆ·æ•°æ®**
   ```sql
   -- ä» Supabase å¯¼å‡ºç”¨æˆ·æ•°æ®
   -- åœ¨é˜¿é‡Œäº‘ RDS ä¸­å¯¼å…¥
   INSERT INTO users (id, email, password_hash, created_at, updated_at)
   SELECT id, email, encrypted_password, created_at, updated_at
   FROM supabase_users;
   ```

4. **æµ‹è¯•è®¤è¯æµç¨‹**
   - æµ‹è¯•æ³¨å†ŒåŠŸèƒ½
   - æµ‹è¯•ç™»å½•åŠŸèƒ½
   - æµ‹è¯•ç™»å‡ºåŠŸèƒ½
   - æµ‹è¯•ä¼šè¯ä¿æŒ

#### 2.3 å­˜å‚¨æœåŠ¡è¿ç§»
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é…ç½®é˜¿é‡Œäº‘ OSS
- [ ] å®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½åŠŸèƒ½
- [ ] è¿ç§»ç°æœ‰æ–‡ä»¶
- [ ] æµ‹è¯•æ–‡ä»¶æ“ä½œ

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **é…ç½®é˜¿é‡Œäº‘ OSS**
   ```typescript
   // src/lib/aliyun-oss.ts
   import OSS from 'ali-oss';

   const client = new OSS({
     region: process.env.VITE_ALIYUN_OSS_REGION,
     accessKeyId: process.env.VITE_ALIYUN_OSS_ACCESS_KEY_ID,
     accessKeySecret: process.env.VITE_ALIYUN_OSS_ACCESS_KEY_SECRET,
     bucket: process.env.VITE_ALIYUN_OSS_BUCKET,
   });

   export default client;
   ```

2. **å®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½åŠŸèƒ½**
   ```typescript
   // src/services/aliyunStorage.ts
   import client from '../lib/aliyun-oss';

   export class AliyunStorageService {
     async uploadFile(fileName: string, file: File): Promise<{ url: string; error: string | null }> {
       try {
         const result = await client.put(fileName, file);
         return { url: result.url, error: null };
       } catch (error) {
         return {
           url: '',
           error: error instanceof Error ? error.message : 'ä¸Šä¼ å¤±è´¥',
         };
       }
     }

     async downloadFile(fileName: string): Promise<{ data: any; error: string | null }> {
       try {
         const result = await client.get(fileName);
         return { data: result.content, error: null };
       } catch (error) {
         return {
           data: null,
           error: error instanceof Error ? error.message : 'ä¸‹è½½å¤±è´¥',
         };
       }
     }

     async deleteFile(fileName: string): Promise<{ error: string | null }> {
       try {
         await client.delete(fileName);
         return { error: null };
       } catch (error) {
         return {
           error: error instanceof Error ? error.message : 'åˆ é™¤å¤±è´¥',
         };
       }
     }
   }

   export const aliyunStorageService = new AliyunStorageService();
   ```

3. **è¿ç§»ç°æœ‰æ–‡ä»¶**
   ```bash
   # ä» Supabase Storage ä¸‹è½½æ‰€æœ‰æ–‡ä»¶
   # ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ OSS
   ```

4. **æµ‹è¯•æ–‡ä»¶æ“ä½œ**
   - æµ‹è¯•æ–‡ä»¶ä¸Šä¼ 
   - æµ‹è¯•æ–‡ä»¶ä¸‹è½½
   - æµ‹è¯•æ–‡ä»¶åˆ é™¤
   - æµ‹è¯•æ–‡ä»¶è®¿é—®æƒé™

---

### é˜¶æ®µ 3ï¼šå‰ç«¯é€‚é…ï¼ˆç¬¬ 4 å‘¨ï¼‰

#### 3.1 API é€‚é…
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ›´æ–°è®¤è¯æœåŠ¡è°ƒç”¨
- [ ] æ›´æ–°æ•°æ®åº“æœåŠ¡è°ƒç”¨
- [ ] æ›´æ–°å­˜å‚¨æœåŠ¡è°ƒç”¨
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **æ›´æ–°è®¤è¯æœåŠ¡è°ƒç”¨**
   ```typescript
   // src/App.tsx
   // ä¿®æ”¹å‰
   import { authService } from './services/supabaseAuth';

   // ä¿®æ”¹å
   import { aliyunAuthService } from './services/aliyunAuth';

   function AppContent() {
     const [isAuthenticated, setIsAuthenticated] = useState(false);

     useEffect(() => {
       const unsubscribe = aliyunAuthService.onAuthChange((user) => {
         setIsAuthenticated(!!user);
       });

       return () => unsubscribe();
     }, []);

     // ...
   }
   ```

2. **æ›´æ–°æ•°æ®åº“æœåŠ¡è°ƒç”¨**
   ```typescript
   // src/hooks/AppProvider.tsx
   // ä¿®æ”¹å‰
   import { databaseService } from '../services/database';

   // ä¿®æ”¹å
   import { aliyunDatabaseService } from '../services/aliyunDatabase';

   export function AppProvider({ children }: { children: React.ReactNode }) {
     const [userId, setUserId] = useState<string | null>(null);

     useEffect(() => {
       const user = aliyunAuthService.getCurrentUser();
       if (user) {
         setUserId(user.id);
         aliyunDatabaseService.setUserId(user.id);
       }
     }, []);

     // ...
   }
   ```

3. **æ›´æ–°å­˜å‚¨æœåŠ¡è°ƒç”¨**
   ```typescript
   // src/components/BookDetail.tsx
   // ä¿®æ”¹å‰
   import { supabase } from '../lib/supabase';

   const handleUploadCover = async (file: File) => {
     const { data, error } = await supabase.storage
       .from('book-covers')
       .upload(`${userId}/${bookId}/${file.name}`, file);
   };

   // ä¿®æ”¹å
   import { aliyunStorageService } from '../services/aliyunStorage';

   const handleUploadCover = async (file: File) => {
     const { url, error } = await aliyunStorageService.uploadFile(
       `${userId}/${bookId}/${file.name}`,
       file
     );
   };
   ```

4. **ç»Ÿä¸€é”™è¯¯å¤„ç†**
   ```typescript
   // src/utils/errorHandler.ts
   export const handleError = (error: any): string => {
     if (error.response) {
       // é˜¿é‡Œäº‘ API é”™è¯¯
       return error.response.data.message || 'è¯·æ±‚å¤±è´¥';
     } else if (error.request) {
       // ç½‘ç»œé”™è¯¯
       return 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®';
     } else {
       // å…¶ä»–é”™è¯¯
       return error.message || 'æœªçŸ¥é”™è¯¯';
     }
   };
   ```

#### 3.2 ç¯å¢ƒå˜é‡æ›´æ–°
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ›´æ–°æœ¬åœ°ç¯å¢ƒå˜é‡
- [ ] æ›´æ–° EdgeOne Pages ç¯å¢ƒå˜é‡
- [ ] éªŒè¯ç¯å¢ƒå˜é‡åŠ è½½

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **æ›´æ–°æœ¬åœ°ç¯å¢ƒå˜é‡**
   ```bash
   # .env.local
   VITE_ALIYUN_RDS_HOST=your-rds-host.rds.aliyuncs.com
   VITE_ALIYUN_RDS_PORT=5432
   VITE_ALIYUN_RDS_USER=your-rds-user
   VITE_ALIYUN_RDS_PASSWORD=your-rds-password
   VITE_ALIYUN_RDS_DATABASE=readrecall

   VITE_ALIYUN_OSS_REGION=oss-cn-hangzhou
   VITE_ALIYUN_OSS_ACCESS_KEY_ID=your-oss-access-key-id
   VITE_ALIYUN_OSS_ACCESS_KEY_SECRET=your-oss-access-key-secret
   VITE_ALIYUN_OSS_BUCKET=readrecall-files

   VITE_ALIYUN_IDAAS_CLIENT_ID=your-idaas-client-id
   VITE_ALIYUN_IDAAS_CLIENT_SECRET=your-idaas-client-secret
   VITE_ALIYUN_IDAAS_REDIRECT_URI=https://linyubo.top/auth/callback
   ```

2. **æ›´æ–° EdgeOne Pages ç¯å¢ƒå˜é‡**
   - è®¿é—® EdgeOne Pages æ§åˆ¶å°
   - è¿›å…¥é¡¹ç›®è®¾ç½®
   - æ·»åŠ ä¸Šè¿°ç¯å¢ƒå˜é‡

3. **éªŒè¯ç¯å¢ƒå˜é‡åŠ è½½**
   ```typescript
   // src/utils/env.ts
   export const validateEnv = () => {
     const requiredVars = [
       'VITE_ALIYUN_RDS_HOST',
       'VITE_ALIYUN_RDS_USER',
       'VITE_ALIYUN_RDS_PASSWORD',
       'VITE_ALIYUN_RDS_DATABASE',
       'VITE_ALIYUN_OSS_REGION',
       'VITE_ALIYUN_OSS_ACCESS_KEY_ID',
       'VITE_ALIYUN_OSS_ACCESS_KEY_SECRET',
       'VITE_ALIYUN_OSS_BUCKET',
       'VITE_ALIYUN_IDAAS_CLIENT_ID',
       'VITE_ALIYUN_IDAAS_CLIENT_SECRET',
     ];

     const missing = requiredVars.filter(v => !import.meta.env[v]);
     if (missing.length > 0) {
       throw new Error(`Missing environment variables: ${missing.join(', ')}`);
     }
   };

   // åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
   import { validateEnv } from './utils/env';
   validateEnv();
   ```

#### 3.3 åŠŸèƒ½æµ‹è¯•
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æµ‹è¯•ç”¨æˆ·è®¤è¯æµç¨‹
- [ ] æµ‹è¯•ä¹¦ç±ç®¡ç†åŠŸèƒ½
- [ ] æµ‹è¯•é—®é¢˜ç®¡ç†åŠŸèƒ½
- [ ] æµ‹è¯•ç»ƒä¹ æ¨¡å¼åŠŸèƒ½
- [ ] æµ‹è¯• AI è¾…åŠ©åŠŸèƒ½
- [ ] æµ‹è¯•è®¾ç½®ç®¡ç†åŠŸèƒ½

**è¯¦ç»†æµ‹è¯•ç”¨ä¾‹ï¼š**

1. **ç”¨æˆ·è®¤è¯æµç¨‹æµ‹è¯•**
   - [ ] æ³¨å†Œæ–°ç”¨æˆ·
   - [ ] ä½¿ç”¨é”™è¯¯å¯†ç ç™»å½•
   - [ ] ä½¿ç”¨æ­£ç¡®å¯†ç ç™»å½•
   - [ ] ç™»å‡ºåé‡æ–°ç™»å½•
   - [ ] åˆ·æ–°é¡µé¢åä¿æŒç™»å½•çŠ¶æ€

2. **ä¹¦ç±ç®¡ç†åŠŸèƒ½æµ‹è¯•**
   - [ ] æ·»åŠ æ–°ä¹¦ç±
   - [ ] ç¼–è¾‘ä¹¦ç±ä¿¡æ¯
   - [ ] åˆ é™¤ä¹¦ç±
   - [ ] ä¸Šä¼ ä¹¦ç±å°é¢
   - [ ] æŸ¥çœ‹ä¹¦ç±åˆ—è¡¨

3. **é—®é¢˜ç®¡ç†åŠŸèƒ½æµ‹è¯•**
   - [ ] æ·»åŠ æ–°é—®é¢˜
   - [ ] ç¼–è¾‘é—®é¢˜
   - [ ] åˆ é™¤é—®é¢˜
   - [ ] æ‰¹é‡åˆ é™¤é—®é¢˜
   - [ ] AI ç”Ÿæˆé—®é¢˜

4. **ç»ƒä¹ æ¨¡å¼åŠŸèƒ½æµ‹è¯•**
   - [ ] æ ‡å‡†ç»ƒä¹ æ¨¡å¼
   - [ ] æ¦‚å¿µç»ƒä¹ æ¨¡å¼
   - [ ] é”™é¢˜ç»ƒä¹ æ¨¡å¼
   - [ ] æ ‡è®°å·²æŒæ¡
   - [ ] æŸ¥çœ‹ç»ƒä¹ ç»Ÿè®¡

5. **AI è¾…åŠ©åŠŸèƒ½æµ‹è¯•**
   - [ ] AI ç”Ÿæˆé—®é¢˜
   - [ ] AI æ‰¹æ”¹ç­”æ¡ˆ
   - [ ] AI ç”Ÿæˆå»ºè®®

6. **è®¾ç½®ç®¡ç†åŠŸèƒ½æµ‹è¯•**
   - [ ] åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼
   - [ ] é…ç½®æ™ºè°± API Key
   - [ ] é…ç½® Dify API Key
   - [ ] æµ‹è¯• API è¿æ¥

---

### é˜¶æ®µ 4ï¼šéƒ¨ç½²å’Œç›‘æ§ï¼ˆç¬¬ 5 å‘¨ï¼‰

#### 4.1 é‡æ–°éƒ¨ç½²
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ„å»ºå‰ç«¯åº”ç”¨
- [ ] éƒ¨ç½²åˆ° EdgeOne Pages
- [ ] é…ç½®è‡ªå®šä¹‰åŸŸå
- [ ] éªŒè¯éƒ¨ç½²æˆåŠŸ

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **æ„å»ºå‰ç«¯åº”ç”¨**
   ```bash
   # å®‰è£…ä¾èµ–
   npm install

   # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
   npm run build

   # æœ¬åœ°é¢„è§ˆ
   npm run preview
   ```

2. **éƒ¨ç½²åˆ° EdgeOne Pages**
   - æ–¹æ³• 1ï¼šé€šè¿‡ GitHub è‡ªåŠ¨éƒ¨ç½²
     - æ¨é€ä»£ç åˆ° GitHub
     - EdgeOne Pages è‡ªåŠ¨è§¦å‘æ„å»º
     - ç­‰å¾…æ„å»ºå®Œæˆ

   - æ–¹æ³• 2ï¼šé€šè¿‡ CLI æ‰‹åŠ¨éƒ¨ç½²
     ```bash
     npm install -g @tencentcloud/edgeone-cli
     edgeone login
     edgeone deploy --prod
     ```

3. **é…ç½®è‡ªå®šä¹‰åŸŸå**
   - åœ¨ EdgeOne Pages æ§åˆ¶å°ï¼š
     - æ·»åŠ åŸŸåï¼šlinyubo.top
     - é…ç½® DNS è®°å½•ï¼š
       ```
       ç±»å‹: CNAME
       ä¸»æœºè®°å½•: @
       è®°å½•å€¼: [EdgeOne æä¾›çš„åŸŸå]
       ```
   - ç­‰å¾… DNS ç”Ÿæ•ˆï¼ˆ5-10 åˆ†é’Ÿï¼‰

4. **éªŒè¯éƒ¨ç½²æˆåŠŸ**
   ```bash
   # æ£€æŸ¥ DNS è§£æ
   nslookup linyubo.top

   # è®¿é—®ç½‘ç«™
   curl https://linyubo.top

   # æ£€æŸ¥ HTTPS è¯ä¹¦
   openssl s_client -connect linyubo.top:443
   ```

#### 4.2 ç›‘æ§é…ç½®
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é…ç½®é˜¿é‡Œäº‘ ARMS ç›‘æ§
- [ ] é…ç½®å‘Šè­¦è§„åˆ™
- [ ] é…ç½®æ—¥å¿—æœåŠ¡
- [ ] é…ç½®æ€§èƒ½ç›‘æ§

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **é…ç½®é˜¿é‡Œäº‘ ARMS ç›‘æ§**
   - è®¿é—®ï¼šhttps://arms.console.aliyun.com
   - åˆ›å»ºåº”ç”¨ç›‘æ§
   - é…ç½®ç›‘æ§æŒ‡æ ‡ï¼š
     - é¡µé¢åŠ è½½æ—¶é—´
     - API å“åº”æ—¶é—´
     - é”™è¯¯ç‡
     - ç”¨æˆ·æ´»è·ƒåº¦

2. **é…ç½®å‘Šè­¦è§„åˆ™**
   ```javascript
   // å‘Šè­¦è§„åˆ™ç¤ºä¾‹
   const alertRules = [
     {
       name: 'API å“åº”æ—¶é—´è¿‡é•¿',
       condition: 'api_response_time > 3000ms',
       duration: '5m',
       severity: 'warning',
     },
     {
       name: 'é”™è¯¯ç‡è¿‡é«˜',
       condition: 'error_rate > 5%',
       duration: '10m',
       severity: 'critical',
     },
     {
       name: 'æ•°æ®åº“è¿æ¥å¤±è´¥',
       condition: 'db_connection_failed',
       duration: '1m',
       severity: 'critical',
     },
   ];
   ```

3. **é…ç½®æ—¥å¿—æœåŠ¡**
   - è®¿é—®ï¼šhttps://sls.console.aliyun.com
   - åˆ›å»ºæ—¥å¿—é¡¹ç›®
   - é…ç½®æ—¥å¿—é‡‡é›†ï¼š
     - å‰ç«¯æ—¥å¿—
     - API æ—¥å¿—
     - æ•°æ®åº“æ—¥å¿—
     - é”™è¯¯æ—¥å¿—

4. **é…ç½®æ€§èƒ½ç›‘æ§**
   - ä½¿ç”¨é˜¿é‡Œäº‘ ARMS APM
   - ç›‘æ§å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼š
     - é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆFCPï¼‰
     - æœ€å¤§å†…å®¹ç»˜åˆ¶ï¼ˆLCPï¼‰
     - é¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼ˆFIDï¼‰
     - ç´¯ç§¯å¸ƒå±€åç§»ï¼ˆCLSï¼‰

---

### é˜¶æ®µ 5ï¼šä¸Šçº¿åˆ‡æ¢ï¼ˆç¬¬ 6 å‘¨ï¼‰

#### 5.1 ç°åº¦å‘å¸ƒ
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] é…ç½®ç°åº¦å‘å¸ƒç­–ç•¥
- [ ] é€‰æ‹©ç°åº¦ç”¨æˆ·
- [ ] ç›‘æ§ç°åº¦æ•ˆæœ
- [ ] é€æ­¥æ‰©å¤§ç°åº¦èŒƒå›´

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **é…ç½®ç°åº¦å‘å¸ƒç­–ç•¥**
   ```typescript
   // src/utils/featureFlag.ts
   export const isAliyunEnabled = (userId: string): boolean => {
     // åŸºäºç”¨æˆ· ID çš„å“ˆå¸Œå€¼å†³å®šæ˜¯å¦ä½¿ç”¨é˜¿é‡Œäº‘
     const hash = userId.split('').reduce((acc, char) => {
       return ((acc << 5) - acc) + char.charCodeAt(0);
     }, 0);

     // 10% çš„ç”¨æˆ·ä½¿ç”¨é˜¿é‡Œäº‘
     return Math.abs(hash) % 10 === 0;
   };
   ```

2. **é€‰æ‹©ç°åº¦ç”¨æˆ·**
   - é€‰æ‹©å†…éƒ¨æµ‹è¯•ç”¨æˆ·
   - é€‰æ‹©æ´»è·ƒç”¨æˆ·
   - é€‰æ‹©æ–°æ³¨å†Œç”¨æˆ·

3. **ç›‘æ§ç°åº¦æ•ˆæœ**
   - ç›‘æ§é”™è¯¯ç‡
   - ç›‘æ§æ€§èƒ½æŒ‡æ ‡
   - æ”¶é›†ç”¨æˆ·åé¦ˆ

4. **é€æ­¥æ‰©å¤§ç°åº¦èŒƒå›´**
   - ç¬¬ä¸€å‘¨ï¼š10% ç”¨æˆ·
   - ç¬¬äºŒå‘¨ï¼š30% ç”¨æˆ·
   - ç¬¬ä¸‰å‘¨ï¼š50% ç”¨æˆ·
   - ç¬¬å››å‘¨ï¼š100% ç”¨æˆ·

#### 5.2 å…¨é‡åˆ‡æ¢
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] ç¡®è®¤ç°åº¦å‘å¸ƒæˆåŠŸ
- [ ] æ›´æ–° DNS è®°å½•
- [ ] éªŒè¯å…¨é‡è®¿é—®
- [ ] ç›‘æ§ç³»ç»ŸçŠ¶æ€

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **ç¡®è®¤ç°åº¦å‘å¸ƒæˆåŠŸ**
   - é”™è¯¯ç‡ä½äº 0.1%
   - æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
   - ç”¨æˆ·åé¦ˆè‰¯å¥½

2. **æ›´æ–° DNS è®°å½•**
   - åœ¨åŸŸåæ³¨å†Œå•†å¤„ï¼š
     ```
     ç±»å‹: CNAME
     ä¸»æœºè®°å½•: @
     è®°å½•å€¼: [EdgeOne æä¾›çš„åŸŸå]
     TTL: 600
     ```

3. **éªŒè¯å…¨é‡è®¿é—®**
   ```bash
   # æ£€æŸ¥ DNS è§£æ
   dig linyubo.top

   # è®¿é—®ç½‘ç«™
   curl -I https://linyubo.top

   # æ£€æŸ¥ SSL è¯ä¹¦
   openssl s_client -connect linyubo.top:443 -servername linyubo.top
   ```

4. **ç›‘æ§ç³»ç»ŸçŠ¶æ€**
   - ç›‘æ§é”™è¯¯ç‡
   - ç›‘æ§æ€§èƒ½æŒ‡æ ‡
   - ç›‘æ§ç”¨æˆ·æ´»è·ƒåº¦
   - ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

#### 5.3 æ—§ç¯å¢ƒä¸‹çº¿
**ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¤‡ä»½ Supabase æ•°æ®
- [ ] åœæ­¢ Supabase æœåŠ¡
- [ ] å–æ¶ˆ Vercel è®¢é˜…
- [ ] æ¸…ç†æ—§èµ„æº

**è¯¦ç»†æ­¥éª¤ï¼š**

1. **å¤‡ä»½ Supabase æ•°æ®**
   ```bash
   # æœ€ç»ˆå¤‡ä»½
   pg_dump -h db.ohqkqnhmgzqeqdsueiih.supabase.co \
           -U postgres \
           -d postgres \
           -F c \
           -f supabase_final_backup.dump
   ```

2. **åœæ­¢ Supabase æœåŠ¡**
   - åœ¨ Supabase Dashboard ä¸­ï¼š
     - æš‚åœé¡¹ç›®
     - ä¿ç•™æ•°æ® 30 å¤©

3. **å–æ¶ˆ Vercel è®¢é˜…**
   - åœ¨ Vercel Dashboard ä¸­ï¼š
     - åˆ é™¤é¡¹ç›®
     - å–æ¶ˆè®¢é˜…

4. **æ¸…ç†æ—§èµ„æº**
   - åˆ é™¤ Vercel é¡¹ç›®
   - åˆ é™¤ Supabase é¡¹ç›®
   - æ¸…ç†ç›¸å…³é…ç½®

---

## æ—¶é—´è§„åˆ’

### æ€»ä½“æ—¶é—´è¡¨ï¼ˆ6 å‘¨ï¼‰

| é˜¶æ®µ | æ—¶é—´ | ä¸»è¦ä»»åŠ¡ | é‡Œç¨‹ç¢‘ |
|------|------|---------|--------|
| **é˜¶æ®µ 1ï¼šå‡†å¤‡é˜¶æ®µ** | ç¬¬ 1 å‘¨ | è´¦æˆ·å‡†å¤‡ã€æ•°æ®å¤‡ä»½ã€ç¯å¢ƒæ­å»º | âœ… å®Œæˆæ‰€æœ‰å‡†å¤‡å·¥ä½œ |
| **é˜¶æ®µ 2ï¼šæ ¸å¿ƒæœåŠ¡è¿ç§»** | ç¬¬ 2-3 å‘¨ | æ•°æ®åº“è¿ç§»ã€è®¤è¯æœåŠ¡è¿ç§»ã€å­˜å‚¨æœåŠ¡è¿ç§» | âœ… æ ¸å¿ƒæœåŠ¡è¿ç§»å®Œæˆ |
| **é˜¶æ®µ 3ï¼šå‰ç«¯é€‚é…** | ç¬¬ 4 å‘¨ | API é€‚é…ã€ç¯å¢ƒå˜é‡æ›´æ–°ã€åŠŸèƒ½æµ‹è¯• | âœ… å‰ç«¯é€‚é…å®Œæˆå¹¶é€šè¿‡æµ‹è¯• |
| **é˜¶æ®µ 4ï¼šéƒ¨ç½²å’Œç›‘æ§** | ç¬¬ 5 å‘¨ | é‡æ–°éƒ¨ç½²ã€ç›‘æ§é…ç½® | âœ… éƒ¨ç½²æˆåŠŸï¼Œç›‘æ§æ­£å¸¸è¿è¡Œ |
| **é˜¶æ®µ 5ï¼šä¸Šçº¿åˆ‡æ¢** | ç¬¬ 6 å‘¨ | ç°åº¦å‘å¸ƒã€å…¨é‡åˆ‡æ¢ã€æ—§ç¯å¢ƒä¸‹çº¿ | âœ… å®Œå…¨åˆ‡æ¢åˆ°é˜¿é‡Œäº‘ |

### è¯¦ç»†ç”˜ç‰¹å›¾

```
å‘¨æ¬¡  1  2  3  4  5  6
      â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
è´¦æˆ·  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
      â”‚
å¤‡ä»½  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
      â”‚
ç¯å¢ƒ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
      â”‚
æ•°æ®åº“    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
          â”‚
è®¤è¯      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
          â”‚
å­˜å‚¨      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
          â”‚
APIé€‚é…          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚
ç¯å¢ƒå˜é‡          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚
åŠŸèƒ½æµ‹è¯•          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                  â”‚
é‡æ–°éƒ¨ç½²              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                      â”‚
ç›‘æ§é…ç½®              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                      â”‚
ç°åº¦å‘å¸ƒ                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                          â”‚
å…¨é‡åˆ‡æ¢                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                          â”‚
æ—§ç¯å¢ƒä¸‹çº¿                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
```

---

## é£é™©è¯„ä¼°

### é£é™©è¯†åˆ«

| é£é™©ç±»å‹ | é£é™©æè¿° | å½±å“ç¨‹åº¦ | å‘ç”Ÿæ¦‚ç‡ | é£é™©ç­‰çº§ |
|---------|---------|---------|---------|---------|
| **æ•°æ®ä¸¢å¤±** | è¿ç§»è¿‡ç¨‹ä¸­æ•°æ®ä¸¢å¤±æˆ–æŸå | é«˜ | ä½ | ä¸­ |
| **æœåŠ¡ä¸­æ–­** | è¿ç§»è¿‡ç¨‹ä¸­æœåŠ¡ä¸å¯ç”¨ | é«˜ | ä¸­ | é«˜ |
| **æ€§èƒ½ä¸‹é™** | æ–°ç¯å¢ƒæ€§èƒ½ä¸å¦‚é¢„æœŸ | ä¸­ | ä¸­ | ä¸­ |
| **å…¼å®¹æ€§é—®é¢˜** | ä»£ç ä¸æ–°æœåŠ¡ä¸å…¼å®¹ | é«˜ | ä¸­ | é«˜ |
| **æˆæœ¬è¶…æ”¯** | æ–°æœåŠ¡æˆæœ¬è¶…å‡ºé¢„ç®— | ä¸­ | ä½ | ä½ |
| **å®‰å…¨é—®é¢˜** | æ•°æ®æ³„éœ²æˆ–å®‰å…¨æ¼æ´ | é«˜ | ä½ | ä¸­ |
| **æ—¶é—´å»¶è¯¯** | è¿ç§»æ—¶é—´è¶…å‡ºé¢„æœŸ | ä¸­ | ä¸­ | ä¸­ |
| **ç”¨æˆ·æµå¤±** | è¿ç§»è¿‡ç¨‹ä¸­ç”¨æˆ·ä½“éªŒä¸‹é™ | é«˜ | ä½ | ä¸­ |

### é£é™©åº”å¯¹ç­–ç•¥

#### é«˜é£é™©åº”å¯¹

1. **æœåŠ¡ä¸­æ–­**
   - **é¢„é˜²æªæ–½**ï¼š
     - é€‰æ‹©ä½å³°æœŸè¿›è¡Œåˆ‡æ¢
     - æå‰è¿›è¡Œå¤šæ¬¡æ¼”ç»ƒ
     - å‡†å¤‡å›æ»šæ–¹æ¡ˆ
   - **åº”æ€¥é¢„æ¡ˆ**ï¼š
     - ç«‹å³å›æ»šåˆ° Supabase
     - é€šçŸ¥ç”¨æˆ·æœåŠ¡ç»´æŠ¤
     - æä¾› FAQ å’Œå¸®åŠ©æ–‡æ¡£

2. **å…¼å®¹æ€§é—®é¢˜**
   - **é¢„é˜²æªæ–½**ï¼š
     - åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†æµ‹è¯•
     - è¿›è¡Œä»£ç å®¡æŸ¥
     - å‡†å¤‡å…¼å®¹æ€§è¡¥ä¸
   - **åº”æ€¥é¢„æ¡ˆ**ï¼š
     - å¿«é€Ÿä¿®å¤å…¼å®¹æ€§é—®é¢˜
     - å‘å¸ƒçƒ­ä¿®å¤ç‰ˆæœ¬
     - æä¾›ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

#### ä¸­é£é™©åº”å¯¹

1. **æ€§èƒ½ä¸‹é™**
   - **é¢„é˜²æªæ–½**ï¼š
     - è¿›è¡Œæ€§èƒ½æµ‹è¯•
     - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
     - ä½¿ç”¨ CDN åŠ é€Ÿ
   - **åº”æ€¥é¢„æ¡ˆ**ï¼š
     - å‡çº§æœåŠ¡å™¨é…ç½®
     - ä¼˜åŒ–ä»£ç å’Œæ•°æ®åº“
     - ä½¿ç”¨ç¼“å­˜ç­–ç•¥

2. **æ—¶é—´å»¶è¯¯**
   - **é¢„é˜²æªæ–½**ï¼š
     - åˆ¶å®šè¯¦ç»†è®¡åˆ’
     - è®¾ç½®é‡Œç¨‹ç¢‘
     - é¢„ç•™ç¼“å†²æ—¶é—´
   - **åº”æ€¥é¢„æ¡ˆ**ï¼š
     - è°ƒæ•´ä¼˜å…ˆçº§
     - å¢åŠ äººåŠ›èµ„æº
     - å»¶é•¿è¿ç§»å‘¨æœŸ

#### ä½é£é™©åº”å¯¹

1. **æˆæœ¬è¶…æ”¯**
   - **é¢„é˜²æªæ–½**ï¼š
     - åˆ¶å®šé¢„ç®—
     - ç›‘æ§èµ„æºä½¿ç”¨
     - é€‰æ‹©åˆé€‚çš„å¥—é¤
   - **åº”æ€¥é¢„æ¡ˆ**ï¼š
     - ä¼˜åŒ–èµ„æºé…ç½®
     - åˆ‡æ¢åˆ°æ›´ä¾¿å®œçš„å¥—é¤
     - ç”³è¯·æŠ˜æ‰£æˆ–ä¼˜æƒ 

2. **å®‰å…¨é—®é¢˜**
   - **é¢„é˜²æªæ–½**ï¼š
     - è¿›è¡Œå®‰å…¨å®¡è®¡
     - ä½¿ç”¨åŠ å¯†ä¼ è¾“
     - é…ç½®é˜²ç«å¢™
   - **åº”æ€¥é¢„æ¡ˆ**ï¼š
     - ç«‹å³ä¿®å¤å®‰å…¨æ¼æ´
     - é€šçŸ¥å—å½±å“ç”¨æˆ·
     - åŠ å¼ºå®‰å…¨æªæ–½

---

## å›æ»šæ–¹æ¡ˆ

### å›æ»šè§¦å‘æ¡ä»¶

åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œç«‹å³è§¦å‘å›æ»šï¼š
- âŒ é”™è¯¯ç‡è¶…è¿‡ 5%
- âŒ API å“åº”æ—¶é—´è¶…è¿‡ 5 ç§’
- âŒ æ•°æ®ä¸¢å¤±æˆ–æŸå
- âŒ ä¸¥é‡å®‰å…¨æ¼æ´
- âŒ ç”¨æˆ·æŠ•è¯‰æ¿€å¢
- âŒ å…³é”®åŠŸèƒ½ä¸å¯ç”¨

### å›æ»šæ­¥éª¤

#### å¿«é€Ÿå›æ»šï¼ˆDNS åˆ‡æ¢ï¼‰
**é¢„è®¡æ—¶é—´ï¼š5-10 åˆ†é’Ÿ**

1. **æ›´æ–° DNS è®°å½•**
   ```bash
   # åœ¨åŸŸåæ³¨å†Œå•†å¤„æ›´æ–° DNS
   ç±»å‹: CNAME
   ä¸»æœºè®°å½•: @
   è®°å½•å€¼: [Vercel æä¾›çš„åŸŸå]
   TTL: 60
   ```

2. **éªŒè¯ DNS ç”Ÿæ•ˆ**
   ```bash
   # æ£€æŸ¥ DNS è§£æ
   dig linyubo.top

   # è®¿é—®ç½‘ç«™
   curl https://linyubo.top
   ```

3. **é€šçŸ¥ç”¨æˆ·**
   - åœ¨åº”ç”¨å†…æ˜¾ç¤ºé€šçŸ¥
   - å‘é€é‚®ä»¶é€šçŸ¥
   - æ›´æ–°çŠ¶æ€é¡µé¢

#### å®Œæ•´å›æ»šï¼ˆä»£ç  + æ•°æ®ï¼‰
**é¢„è®¡æ—¶é—´ï¼š30-60 åˆ†é’Ÿ**

1. **å›æ»šä»£ç **
   ```bash
   # åˆ‡æ¢å› Supabase åˆ†æ”¯
   git checkout main

   # æ›´æ–°ç¯å¢ƒå˜é‡
   # æ¢å¤ Supabase é…ç½®

   # é‡æ–°éƒ¨ç½²
   npm run build
   edgeone deploy --prod
   ```

2. **å›æ»šæ•°æ®**
   ```bash
   # ä»å¤‡ä»½æ¢å¤æ•°æ®
   pg_restore -h db.ohqkqnhmgzqeqdsueiih.supabase.co \
              -U postgres \
              -d postgres \
              -f supabase_final_backup.dump
   ```

3. **éªŒè¯åŠŸèƒ½**
   - æµ‹è¯•ç™»å½•åŠŸèƒ½
   - æµ‹è¯•æ•°æ®è®¿é—®
   - æµ‹è¯•å…³é”®åŠŸèƒ½

4. **é€šçŸ¥ç”¨æˆ·**
   - å‘é€é‚®ä»¶é€šçŸ¥
   - æ›´æ–°çŠ¶æ€é¡µé¢
   - æä¾›è¡¥å¿æªæ–½

### å›æ»šéªŒè¯æ¸…å•

- [ ] DNS è§£ææ­£ç¡®
- [ ] ç½‘ç«™å¯æ­£å¸¸è®¿é—®
- [ ] ç”¨æˆ·å¯ä»¥ç™»å½•
- [ ] æ•°æ®å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡
- [ ] å…³é”®åŠŸèƒ½æ­£å¸¸
- [ ] æ€§èƒ½æŒ‡æ ‡æ­£å¸¸
- [ ] é”™è¯¯ç‡ä½äºé˜ˆå€¼
- [ ] ç”¨æˆ·åé¦ˆæ­£å¸¸

---

## éªŒè¯æµ‹è¯•

### æµ‹è¯•ç­–ç•¥

#### 1. å•å…ƒæµ‹è¯•
```typescript
// src/services/__tests__/aliyunAuth.test.ts
import { aliyunAuthService } from '../aliyunAuth';

describe('AliyunAuthService', () => {
  test('should sign up a new user', async () => {
    const { user, error } = await aliyunAuthService.signUp(
      'test@example.com',
      'password123'
    );
    expect(error).toBeNull();
    expect(user).not.toBeNull();
    expect(user?.email).toBe('test@example.com');
  });

  test('should sign in an existing user', async () => {
    const { user, error } = await aliyunAuthService.signIn(
      'test@example.com',
      'password123'
    );
    expect(error).toBeNull();
    expect(user).not.toBeNull();
  });

  test('should sign out a user', async () => {
    const { error } = await aliyunAuthService.signOut();
    expect(error).toBeNull();
    expect(aliyunAuthService.isAuthenticated()).toBe(false);
  });
});
```

#### 2. é›†æˆæµ‹è¯•
```typescript
// src/integration/__tests__/fullFlow.test.ts
import { aliyunAuthService } from '../../services/aliyunAuth';
import { aliyunDatabaseService } from '../../services/aliyunDatabase';

describe('Full User Flow', () => {
  test('should complete full user journey', async () => {
    // 1. æ³¨å†Œç”¨æˆ·
    const { user } = await aliyunAuthService.signUp(
      'integration@example.com',
      'password123'
    );
    expect(user).not.toBeNull();

    // 2. æ·»åŠ ä¹¦ç±
    const book = await aliyunDatabaseService.createBook(user!.id, {
      title: 'æµ‹è¯•ä¹¦ç±',
      author: 'æµ‹è¯•ä½œè€…',
    });
    expect(book).not.toBeNull();

    // 3. æ·»åŠ é—®é¢˜
    const question = await aliyunDatabaseService.createQuestion(user!.id, book!.id, {
      question: 'æµ‹è¯•é—®é¢˜',
      answer: 'æµ‹è¯•ç­”æ¡ˆ',
    });
    expect(question).not.toBeNull();

    // 4. ç™»å‡º
    await aliyunAuthService.signOut();
    expect(aliyunAuthService.isAuthenticated()).toBe(false);
  });
});
```

#### 3. æ€§èƒ½æµ‹è¯•
```typescript
// src/performance/__tests__/apiPerformance.test.ts
describe('API Performance', () => {
  test('should respond within 1 second', async () => {
    const start = Date.now();
    await aliyunDatabaseService.getAllBooks('test-user-id');
    const duration = Date.now() - start;
    expect(duration).toBeLessThan(1000);
  });

  test('should handle concurrent requests', async () => {
    const requests = Array(100).fill(null).map(() =>
      aliyunDatabaseService.getAllBooks('test-user-id')
    );
    const results = await Promise.all(requests);
    expect(results).toHaveLength(100);
  });
});
```

#### 4. å®‰å…¨æµ‹è¯•
```typescript
// src/security/__tests__/authSecurity.test.ts
describe('Authentication Security', () => {
  test('should reject weak passwords', async () => {
    const { error } = await aliyunAuthService.signUp(
      'test@example.com',
      '123'
    );
    expect(error).not.toBeNull();
    expect(error?.message).toContain('å¯†ç ');
  });

  test('should reject duplicate email', async () => {
    await aliyunAuthService.signUp('test@example.com', 'password123');
    const { error } = await aliyunAuthService.signUp(
      'test@example.com',
      'password456'
    );
    expect(error).not.toBeNull();
    expect(error?.message).toContain('å·²è¢«æ³¨å†Œ');
  });
});
```

### æµ‹è¯•æ‰§è¡Œè®¡åˆ’

| æµ‹è¯•ç±»å‹ | æ‰§è¡Œæ—¶é—´ | è´Ÿè´£äºº | é€šè¿‡æ ‡å‡† |
|---------|---------|--------|---------|
| **å•å…ƒæµ‹è¯•** | ç¬¬ 4 å‘¨ | å¼€å‘äººå‘˜ | 100% é€šè¿‡ |
| **é›†æˆæµ‹è¯•** | ç¬¬ 4 å‘¨ | å¼€å‘äººå‘˜ | 100% é€šè¿‡ |
| **æ€§èƒ½æµ‹è¯•** | ç¬¬ 4 å‘¨ | å¼€å‘äººå‘˜ | æ»¡è¶³æ€§èƒ½è¦æ±‚ |
| **å®‰å…¨æµ‹è¯•** | ç¬¬ 4 å‘¨ | å®‰å…¨å·¥ç¨‹å¸ˆ | æ— é«˜å±æ¼æ´ |
| **ç”¨æˆ·éªŒæ”¶æµ‹è¯•** | ç¬¬ 5 å‘¨ | äº§å“ç»ç† | æ»¡è¶³ç”¨æˆ·éœ€æ±‚ |

---

## ä¸Šçº¿åˆ‡æ¢

### åˆ‡æ¢å‰æ£€æŸ¥æ¸…å•

#### æŠ€æœ¯æ£€æŸ¥
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡
- [ ] å®‰å…¨æ‰«æé€šè¿‡
- [ ] ç›‘æ§é…ç½®å®Œæˆ
- [ ] æ—¥å¿—é…ç½®å®Œæˆ
- [ ] å¤‡ä»½å®Œæˆ
- [ ] å›æ»šæ–¹æ¡ˆå‡†å¤‡å°±ç»ª

#### ä¸šåŠ¡æ£€æŸ¥
- [ ] åŠŸèƒ½éªŒè¯å®Œæˆ
- [ ] ç”¨æˆ·æ–‡æ¡£æ›´æ–°
- [ ] å¸®åŠ©æ–‡æ¡£æ›´æ–°
- [ ] FAQ æ›´æ–°
- [ ] å®¢æœåŸ¹è®­å®Œæˆ
- [ ] ç”¨æˆ·é€šçŸ¥å‡†å¤‡

#### è¿è¥æ£€æŸ¥
- [ ] ç›‘æ§å‘Šè­¦é…ç½®
- [ ] è¿ç»´æ–‡æ¡£æ›´æ–°
- [ ] åº”æ€¥é¢„æ¡ˆå‡†å¤‡
- [ ] å›¢é˜Ÿå€¼ç­å®‰æ’
- [ ] æ²Ÿé€šæ¸ é“ç•…é€š

### åˆ‡æ¢æµç¨‹

#### åˆ‡æ¢å‰ï¼ˆT-1 å¤©ï¼‰
1. **æœ€ç»ˆæ£€æŸ¥**
   - ç¡®è®¤æ‰€æœ‰æ£€æŸ¥é¡¹å®Œæˆ
   - å¬å¼€åˆ‡æ¢å‰ä¼šè®®
   - ç¡®è®¤åˆ‡æ¢æ—¶é—´çª—å£

2. **æ•°æ®åŒæ­¥**
   - æœ€åä¸€æ¬¡æ•°æ®åŒæ­¥
   - éªŒè¯æ•°æ®ä¸€è‡´æ€§
   - å¤‡ä»½æœ€ç»ˆæ•°æ®

3. **é€šçŸ¥å‡†å¤‡**
   - å‡†å¤‡ç”¨æˆ·é€šçŸ¥
   - å‡†å¤‡çŠ¶æ€é¡µé¢
   - å‡†å¤‡ FAQ

#### åˆ‡æ¢ä¸­ï¼ˆT æ—¥ï¼‰
1. **ç°åº¦å‘å¸ƒï¼ˆ10:00-12:00ï¼‰**
   - å¼€å¯ 10% æµé‡
   - ç›‘æ§å…³é”®æŒ‡æ ‡
   - æ”¶é›†ç”¨æˆ·åé¦ˆ

2. **æ‰©å¤§ç°åº¦ï¼ˆ14:00-16:00ï¼‰**
   - æ‰©å¤§åˆ° 50% æµé‡
   - æŒç»­ç›‘æ§
   - å‡†å¤‡åº”æ€¥é¢„æ¡ˆ

3. **å…¨é‡åˆ‡æ¢ï¼ˆ18:00-20:00ï¼‰**
   - åˆ‡æ¢ 100% æµé‡
   - å…¨é¢ç›‘æ§
   - éªŒè¯æ‰€æœ‰åŠŸèƒ½

#### åˆ‡æ¢åï¼ˆT+1 å¤©ï¼‰
1. **æŒç»­ç›‘æ§**
   - ç›‘æ§é”™è¯¯ç‡
   - ç›‘æ§æ€§èƒ½æŒ‡æ ‡
   - ç›‘æ§ç”¨æˆ·åé¦ˆ

2. **é—®é¢˜å¤„ç†**
   - å¿«é€Ÿå“åº”é—®é¢˜
   - åŠæ—¶ä¿®å¤ bug
   - æ›´æ–°æ–‡æ¡£

3. **æ€»ç»“å¤ç›˜**
   - æ€»ç»“åˆ‡æ¢è¿‡ç¨‹
   - åˆ†æé—®é¢˜åŸå› 
   - åˆ¶å®šæ”¹è¿›æªæ–½

### åˆ‡æ¢åéªŒè¯

#### åŠŸèƒ½éªŒè¯
- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œ
- [ ] ç”¨æˆ·å¯ä»¥ç™»å½•
- [ ] æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] åŠŸèƒ½æ­£å¸¸ä½¿ç”¨
- [ ] æ€§èƒ½æ»¡è¶³è¦æ±‚

#### æ€§èƒ½éªŒè¯
- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 2 ç§’
- [ ] API å“åº”æ—¶é—´ < 500ms
- [ ] é”™è¯¯ç‡ < 0.1%
- [ ] å¹¶å‘æ”¯æŒ > 1000

#### å®‰å…¨éªŒè¯
- [ ] æ•°æ®ä¼ è¾“åŠ å¯†
- [ ] ç”¨æˆ·æ•°æ®éš”ç¦»
- [ ] æƒé™æ§åˆ¶æ­£ç¡®
- [ ] æ— å®‰å…¨æ¼æ´

---

## é™„å½•

### A. ç¯å¢ƒå˜é‡æ¸…å•

```bash
# é˜¿é‡Œäº‘ RDS é…ç½®
VITE_ALIYUN_RDS_HOST=your-rds-host.rds.aliyuncs.com
VITE_ALIYUN_RDS_PORT=5432
VITE_ALIYUN_RDS_USER=your-rds-user
VITE_ALIYUN_RDS_PASSWORD=your-rds-password
VITE_ALIYUN_RDS_DATABASE=readrecall

# é˜¿é‡Œäº‘ OSS é…ç½®
VITE_ALIYUN_OSS_REGION=oss-cn-hangzhou
VITE_ALIYUN_OSS_ACCESS_KEY_ID=your-oss-access-key-id
VITE_ALIYUN_OSS_ACCESS_KEY_SECRET=your-oss-access-key-secret
VITE_ALIYUN_OSS_BUCKET=readrecall-files

# é˜¿é‡Œäº‘ IDaaS é…ç½®
VITE_ALIYUN_IDAAS_CLIENT_ID=your-idaas-client-id
VITE_ALIYUN_IDAAS_CLIENT_SECRET=your-idaas-client-secret
VITE_ALIYUN_IDAAS_REDIRECT_URI=https://linyubo.top/auth/callback

# æ™ºè°± AI é…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
VITE_ZHIPU_API_KEY=your-zhipu-api-key
VITE_ZHIPU_MODEL=glm-4

# Dify é…ç½®ï¼ˆä¿æŒä¸å˜ï¼‰
VITE_DIFY_API_KEY=your-dify-api-key
VITE_DIFY_QUESTION_WORKFLOW_URL=your-dify-question-workflow-url
VITE_DIFY_CORRECTION_WORKFLOW_URL=your-dify-correction-workflow-url
```

### B. æ•°æ®åº“è¿ç§»è„šæœ¬

```sql
-- supabase/migrations/001_initial_schema_aliyun.sql

-- åˆ›å»ºæ‰©å±•
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- åˆ›å»ºç”¨æˆ·è¡¨
CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºä¹¦ç±è¡¨
CREATE TABLE IF NOT EXISTS books (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  author TEXT,
  cover_url TEXT,
  description TEXT,
  question_count INTEGER DEFAULT 0,
  mastered_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºé—®é¢˜è¡¨
CREATE TABLE IF NOT EXISTS questions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  book_id UUID NOT NULL REFERENCES books(id) ON DELETE CASCADE,
  user_id UUID NOT NULL REFERENCES users(id),
  question TEXT NOT NULL,
  answer TEXT,
  type TEXT DEFAULT 'standard',
  difficulty INTEGER DEFAULT 1,
  mastered BOOLEAN DEFAULT FALSE,
  last_reviewed_at TIMESTAMP WITH TIME ZONE,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç”¨æˆ·è®¾ç½®è¡¨
CREATE TABLE IF NOT EXISTS user_settings (
  user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,
  dark_mode BOOLEAN DEFAULT FALSE,
  zhipu_api_key TEXT,
  zhipu_model TEXT DEFAULT 'glm-4',
  dify_api_key TEXT,
  question_workflow_url TEXT,
  correction_workflow_url TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_books_user_id ON books(user_id);
CREATE INDEX IF NOT EXISTS idx_questions_book_id ON questions(book_id);
CREATE INDEX IF NOT EXISTS idx_questions_user_id ON questions(user_id);
CREATE INDEX IF NOT EXISTS idx_questions_mastered ON questions(mastered);
CREATE INDEX IF NOT EXISTS idx_questions_type ON questions(type);

-- åˆ›å»ºè§¦å‘å™¨ï¼šè‡ªåŠ¨æ›´æ–° updated_at
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

CREATE TRIGGER update_books_updated_at BEFORE UPDATE ON books
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_questions_updated_at BEFORE UPDATE ON questions
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();

CREATE TRIGGER update_user_settings_updated_at BEFORE UPDATE ON user_settings
    FOR EACH ROW EXECUTE FUNCTION update_updated_at_column();
```

### C. API æ¥å£æ–‡æ¡£

#### è®¤è¯æ¥å£

**æ³¨å†Œç”¨æˆ·**
```
POST /api/auth/signup
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

Response:
{
  "user": {
    "id": "uuid",
    "email": "user@example.com"
  },
  "token": "jwt-token"
}
```

**ç™»å½•ç”¨æˆ·**
```
POST /api/auth/signin
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}

Response:
{
  "user": {
    "id": "uuid",
    "email": "user@example.com"
  },
  "token": "jwt-token"
}
```

**ç™»å‡ºç”¨æˆ·**
```
POST /api/auth/signout
Authorization: Bearer jwt-token

Response:
{
  "success": true
}
```

#### æ•°æ®åº“æ¥å£

**è·å–æ‰€æœ‰ä¹¦ç±**
```
GET /api/books
Authorization: Bearer jwt-token

Response:
{
  "books": [
    {
      "id": "uuid",
      "title": "ä¹¦ç±æ ‡é¢˜",
      "author": "ä½œè€…",
      "coverUrl": "å°é¢URL",
      "description": "æè¿°",
      "questionCount": 10,
      "masteredCount": 5,
      "createdAt": "2025-01-01T00:00:00Z",
      "updatedAt": "2025-01-01T00:00:00Z"
    }
  ]
}
```

**åˆ›å»ºä¹¦ç±**
```
POST /api/books
Authorization: Bearer jwt-token
Content-Type: application/json

{
  "title": "ä¹¦ç±æ ‡é¢˜",
  "author": "ä½œè€…",
  "coverUrl": "å°é¢URL",
  "description": "æè¿°"
}

Response:
{
  "book": {
    "id": "uuid",
    "title": "ä¹¦ç±æ ‡é¢˜",
    "author": "ä½œè€…",
    "coverUrl": "å°é¢URL",
    "description": "æè¿°",
    "questionCount": 0,
    "masteredCount": 0,
    "createdAt": "2025-01-01T00:00:00Z",
    "updatedAt": "2025-01-01T00:00:00Z"
  }
}
```

### D. ç›‘æ§æŒ‡æ ‡

#### å…³é”®æ€§èƒ½æŒ‡æ ‡ï¼ˆKPIï¼‰

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å‘Šè­¦é˜ˆå€¼ | è¯´æ˜ |
|------|--------|---------|------|
| **é¡µé¢åŠ è½½æ—¶é—´** | < 2s | > 3s | é¦–é¡µåŠ è½½æ—¶é—´ |
| **API å“åº”æ—¶é—´** | < 500ms | > 1s | API å¹³å‡å“åº”æ—¶é—´ |
| **é”™è¯¯ç‡** | < 0.1% | > 1% | è¯·æ±‚é”™è¯¯ç‡ |
| **å¯ç”¨æ€§** | > 99.9% | < 99.5% | æœåŠ¡å¯ç”¨æ€§ |
| **å¹¶å‘ç”¨æˆ·æ•°** | > 1000 | < 500 | åŒæ—¶åœ¨çº¿ç”¨æˆ·æ•° |

#### ä¸šåŠ¡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | ç›‘æ§é¢‘ç‡ | è¯´æ˜ |
|------|--------|---------|------|
| **æ—¥æ´»è·ƒç”¨æˆ·ï¼ˆDAUï¼‰** | > 100 | æ¯æ—¥ | æ¯æ—¥æ´»è·ƒç”¨æˆ·æ•° |
| **æœˆæ´»è·ƒç”¨æˆ·ï¼ˆMAUï¼‰** | > 500 | æ¯æœˆ | æ¯æœˆæ´»è·ƒç”¨æˆ·æ•° |
| **ç”¨æˆ·ç•™å­˜ç‡** | > 30% | æ¯æœˆ | 7æ—¥ç•™å­˜ç‡ |
| **å¹³å‡ä¼šè¯æ—¶é•¿** | > 10min | æ¯æ—¥ | ç”¨æˆ·å¹³å‡ä½¿ç”¨æ—¶é•¿ |
| **é—®é¢˜å®Œæˆç‡** | > 80% | æ¯æ—¥ | é—®é¢˜å®Œæˆæ¯”ä¾‹ |

### E. è”ç³»æ–¹å¼

#### æŠ€æœ¯æ”¯æŒ
- **é˜¿é‡Œäº‘æŠ€æœ¯æ”¯æŒ**ï¼š95187
- **è…¾è®¯äº‘æŠ€æœ¯æ”¯æŒ**ï¼š95081
- **æ™ºè°± AI æŠ€æœ¯æ”¯æŒ**ï¼šhttps://open.bigmodel.cn/support

#### é¡¹ç›®å›¢é˜Ÿ
- **é¡¹ç›®è´Ÿè´£äºº**ï¼š[å§“å]
- **æŠ€æœ¯è´Ÿè´£äºº**ï¼š[å§“å]
- **è¿ç»´è´Ÿè´£äºº**ï¼š[å§“å]

---

## æ€»ç»“

æœ¬è¿ç§»å®æ–½è®¡åˆ’è¯¦ç»†æè¿°äº†å°†"é˜…è¯»å›å“"é¡¹ç›®ä» Supabase è¿ç§»åˆ°é˜¿é‡Œäº‘æœåŠ¡çš„å®Œæ•´æµç¨‹ã€‚é€šè¿‡åˆ†é˜¶æ®µã€æœ‰è®¡åˆ’çš„è¿ç§»ï¼Œå¯ä»¥æœ€å¤§ç¨‹åº¦åœ°é™ä½é£é™©ï¼Œç¡®ä¿è¿ç§»æˆåŠŸã€‚

### å…³é”®æˆåŠŸå› ç´ 
1. **å……åˆ†çš„å‡†å¤‡å·¥ä½œ**ï¼šæ•°æ®å¤‡ä»½ã€ç¯å¢ƒæ­å»ºã€ä»£ç å‡†å¤‡
2. **è¯¦ç»†çš„æµ‹è¯•éªŒè¯**ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ã€å®‰å…¨æµ‹è¯•
3. **å®Œå–„çš„ç›‘æ§å‘Šè­¦**ï¼šå®æ—¶ç›‘æ§ã€åŠæ—¶å‘Šè­¦ã€å¿«é€Ÿå“åº”
4. **çµæ´»çš„å›æ»šæ–¹æ¡ˆ**ï¼šå¿«é€Ÿå›æ»šã€æ•°æ®æ¢å¤ã€æœåŠ¡æ¢å¤
5. **æœ‰æ•ˆçš„æ²Ÿé€šåä½œ**ï¼šå›¢é˜Ÿåä½œã€ç”¨æˆ·æ²Ÿé€šã€é—®é¢˜åé¦ˆ

### é¢„æœŸæ”¶ç›Š
- âœ… **å®Œå…¨å›½äº§åŒ–**ï¼šæ‰€æœ‰æœåŠ¡ä½¿ç”¨å›½äº§äº‘å¹³å°
- âœ… **è®¿é—®é€Ÿåº¦æå‡**ï¼šå›½å†…è®¿é—®é€Ÿåº¦æ›´å¿«
- âœ… **åˆè§„æ€§å¢å¼º**ï¼šç¬¦åˆå›½å†…æ•°æ®å­˜å‚¨è¦æ±‚
- âœ… **æˆæœ¬ä¼˜åŒ–**ï¼šé™ä½è¿è¥æˆæœ¬
- âœ… **æŠ€æœ¯è‡ªä¸»å¯æ§**ï¼šå‡å°‘å¯¹æµ·å¤–æœåŠ¡çš„ä¾èµ–

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
**æœ€åæ›´æ–°**ï¼š2025-02-20
**ç»´æŠ¤äººå‘˜**ï¼šé¡¹ç›®å›¢é˜Ÿ